<div data-th-fragment="comic_info_fragment">

    <!-- container -->
    <div class="container p-0" id="container">

        <!-- 操作按钮row -->
        <div class="row mt-5 r1">
            <div class="col-2 offset-2 mt-4 c1">
                <div class="btn-group float-left">
                    <button type="button"
                            class="btn btn-dark btn-twitter btn-sm"
                            @click="insertModalOpen">
                        <i class="fa fa-plus-circle"></i>&nbsp;&nbsp;添加
                    </button>
                    <button type="button"
                            class="btn btn-dark btn-twitter btn-sm"
                            @click="deleteBatch">
                        <i class='fa fa-trash'></i>&nbsp;&nbsp;删除
                    </button>
                </div>
            </div>
            <div class="col-4 offset-1 mt-4">
                <form id="selectContentForm">
                    <div class="input-group input-group-sm w-75 float-right">
                        <div class="input-group-prepend">
                            <span class="input-group-text">番剧名:</span>
                        </div>
                        <input type="search" class="form-control" name="selectComicName"/>
                        <div class="input-group-append">
                            <button class="btn btn-dark btn-twitter btn-sm" type="button"
                                    @click="selectContent">
                                <i class="fa fa-filter"></i>&nbsp;&nbsp;查询
                            </button>
                            <button class="btn btn-dark btn-twitter btn-sm" type="button"
                                    @click="clearSelectContent">
                                <i class="fa fa-eraser"></i>&nbsp;&nbsp;清空
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <!-- 数据表格row -->
        <div class="row mt-3 r2">
            <div class="col-10 offset-2 c1">
                <table class="table table-dark table-borderless rounded bg-twittercont" v-show="pageInfo != ''">
                    <thead>
                    <tr>
                        <td class="text-center"></td>
                        <td class="text-center font-size-14">图片</td>
                        <td class="text-center font-size-14" style="width:15%">番剧名</td>
                        <td class="text-center font-size-14" style="width:35%">简介</td>
                        <td class="text-center font-size-14" style="width:10%">状态</td>
                        <td class="text-center font-size-14" style="width:11%">标签</td>
                        <td class="text-center font-size-14" style="width:14%">时间</td>
                        <td class="text-center font-size-14" style="width:15%">管理</td>
                    </tr>
                    </thead>
                    <tbody>
                    <tr v-for="(item,index) in pageInfo.list" :key="index">
                        <td>
                            <div class="custom-control custom-checkbox">
                                <input type="checkbox" class="custom-control-input"
                                       :id="'customCheck-'+ index" :value="item.id" v-model="ids"/>
                                <label class="custom-control-label" :for="'customCheck-'+ index"></label>
                            </div>
                        </td>
                        <td class="box">
                            <img :src="'/'+ item.comicImageUrl" class="table-cmimg rounded"/>
                            <a :href="item.comicLink" target="_blank">
                                <div class="bmbox"><i class="fa fa-play-circle-o fa-5x"></i><br/><br/><br/></div>
                            </a>
                        </td>
                        <td class="font-size-12 text-center align-middle">{{item.comicName}}</td>
                        <td class="font-size-12"><p class="table-cmcontent text-justify">{{item.comicContent |
                            cmContentFilter}}</p></td>
                        <td class="font-size-12 text-center align-middle">{{item.comicStatus |
                            cmStatusFilter(item.comicCurrentEpisodes)}}
                        </td>
                        <td class="font-size-12 text-center align-middle">{{item.comicLabel | cmLabelFilter}}</td>
                        <td class="font-size-12 text-center align-middle">{{item.comicTime}}</td>
                        <td class="text-center align-middle">
                            <button type="button" class="btn btn-warning btn-sm font-size-14 text-light"
                                    @click="detailModalOpen(item.id)">
                                <i class="fa fa-file-text-o"></i>&nbsp;&nbsp;详情
                            </button>
                            <br/><br/>
                            <button type="button" class="btn btn-info btn-sm font-size-14"
                                    @click="updateModalOpen(item.id)">
                                <i class="fa fa-pencil-square-o"></i>&nbsp;&nbsp;修改
                            </button>
                        </td>
                    </tr>
                    </tbody>
                </table>
                <div class="d-flex align-items-center justify-content-center flex-row lead text-white font-size-14">
                    <span v-show="pageInfo == ''"><i class="fa fa-exclamation-triangle"></i>&nbsp;&nbsp;查询不到数据</span>
                </div>
            </div>
        </div>

        <!-- 数据表格信息及分页row -->
        <div class="row mt-4 mb-5 r3">
            <div class="col-2 offset-2">
                <span class="badge badge-dark bg-twittercont font-size-14"
                      v-text="'共' + pageInfo.pages + '页/' + pageInfo.total + '个'" v-show="pageInfo != ''"></span>
                <span class="badge badge-dark bg-twittercont font-size-14" v-show="pageInfo == ''">共0页/0个</span>
            </div>

            <div class="col-8 c2">
                <nav>
                    <ul class="pagination float-right font-size-14">
                        <li class='page-item'>
                            <a class='page-link bg-twittercont border-twittercont text-white'
                               href='javascript:void(0)' v-show="!pageInfo.isFirstPage"
                               @click="toFirstPage">首页</a>
                        </li>
                        <li class='page-item'>
                            <a class='page-link bg-twittercont border-twittercont text-white'
                               href='javascript:void(0)' v-show="!pageInfo.isFirstPage"
                               @click="toPrePage">上一页</a>
                        </li>
                        <div v-for="item in pageInfo.navigatepageNums">
                            <div v-if="pageInfo.pageNum == item">
                                <li class='page-item active'>
                                    <a class='page-link border-twittercont'
                                       href='javascript:void(0)'>{{item}}</a>
                                </li>
                            </div>
                            <div v-else>
                                <li class='page-item'>
                                    <a class='page-link bg-twittercont border-twittercont text-white'
                                       href='javascript:void(0)' @click="toClickPage(item)">{{item}}</a>
                                </li>
                            </div>
                        </div>
                        <li class='page-item'>
                            <a class='page-link bg-twittercont border-twittercont text-white'
                               href='javascript:void(0)' v-show="!pageInfo.isLastPage" @click="toNextPage">下一页</a>
                        </li>
                        <li class='page-item'>
                            <a class='page-link bg-twittercont border-twittercont text-white'
                               href='javascript:void(0)' v-show="!pageInfo.isLastPage"
                               @click="toLastPage(pageInfo.pages)">末页</a>
                        </li>
                    </ul>
                </nav>
            </div>
        </div>

        <!-- 番剧modal -->
        <div class="modal fade" id="comicModal" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">
                    <form id="comicForm" enctype="multipart/form-data">
                        <div class="modal-header">
                            <h5 class="modal-title">
                                <strong>{{modalTitle}}</strong>
                            </h5>
                            <button type="button" class="close" data-dismiss="modal">
                                <span><i class="fa fa-window-close text-white font-size-30"></i></span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <div class="form-group d-none">
                                <label class="col-form-label"> id：</label>
                                <input type="text" class="form-control" name="id" v-model="id"/>
                            </div>
                            <div class="form-group">
                                <label class="col-form-label"> 番剧名：</label>
                                <input type="text" class="form-control" name="comicName"
                                       placeholder="请输入番剧名字" v-model="comicName" :disabled="isDetailModal"/>
                            </div>
                            <div class="form-group">
                                <label class="col-form-label"> 时间：</label>
                                <div class="input-group">
                                    <input type="text" class="form-control datepicker"
                                           name="comicTime" placeholder="0000-00-00" v-model="comicTime"
                                           :disabled="isDetailModal"/>
                                    <div class="input-group-append">
                                        <span class="input-group-text"><i class="fa fa-calendar"></i></span>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-form-label"> 简介：</label>
                                <textarea class="form-control" name="comicContent" placeholder="请输入简介" rows="6"
                                          v-model="comicContent" :disabled="isDetailModal"></textarea>
                            </div>
                            <div class="form-group">
                                <label class="col-form-label"> 状态：</label>
                                <div class="custom-control custom-radio custom-control-inline">
                                    <input type="radio" id="comicStatus1" name="comicStatus"
                                           class="custom-control-input" value="0" v-model="comicStatus"
                                           :disabled="isDetailModal"/>
                                    <label class="custom-control-label" for="comicStatus1">已完结</label>
                                </div>
                                <div class="custom-control custom-radio custom-control-inline">
                                    <input type="radio" id="comicStatus2" name="comicStatus"
                                           class="custom-control-input" value="8" v-model="comicStatus"
                                           :disabled="isDetailModal"/>
                                    <label class="custom-control-label" for="comicStatus2">更新中</label>
                                </div>
                            </div>
                            <div class="form-group" v-show="isUdTimeShow">
                                <label class="col-form-label"> 更新时间：</label>
                                <select class="form-control" name="comicUdTime" v-model="comicUdTime"
                                        :disabled="isDetailModal">
                                    <option value="" selected disabled>----请选择更新时间----</option>
                                    <option value="1">周一更新</option>
                                    <option value="2">周二更新</option>
                                    <option value="3">周三更新</option>
                                    <option value="4">周四更新</option>
                                    <option value="5">周五更新</option>
                                    <option value="6">周六更新</option>
                                    <option value="7">周日更新</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="col-form-label"> 当前话数：</label>
                                <input type="number" class="form-control" name="comicCurrentEpisodes"
                                       placeholder="请输入当前话数" v-model="comicCurrentEpisodes"
                                       :disabled="isDetailModal"/>
                            </div>
                            <div class="form-group">
                                <label class="col-form-label"> 标签：</label><br/>
                                <div class="custom-control custom-checkbox custom-control-inline">
                                    <input type="checkbox" class="custom-control-input"
                                           id="comicTag1" value="热血" name="comicTag" v-model="comicTag"
                                           :disabled="isDetailModal"/>
                                    <label class="custom-control-label" for="comicTag1">热血</label>
                                </div>
                                <div class="custom-control custom-checkbox custom-control-inline">
                                    <input type="checkbox" class="custom-control-input"
                                           id="comicTag2" value="机战" name="comicTag" v-model="comicTag"
                                           :disabled="isDetailModal"/>
                                    <label class="custom-control-label" for="comicTag2">机战</label>
                                </div>
                                <div class="custom-control custom-checkbox custom-control-inline">
                                    <input type="checkbox" class="custom-control-input"
                                           id="comicTag3" value="萌系" name="comicTag" v-model="comicTag"
                                           :disabled="isDetailModal"/>
                                    <label class="custom-control-label" for="comicTag3">萌系</label>
                                </div>
                                <div class="custom-control custom-checkbox custom-control-inline">
                                    <input type="checkbox" class="custom-control-input"
                                           id="comicTag4" value="催泪" name="comicTag" v-model="comicTag"
                                           :disabled="isDetailModal"/>
                                    <label class="custom-control-label" for="comicTag4">催泪</label>
                                </div>
                                <div class="custom-control custom-checkbox custom-control-inline">
                                    <input type="checkbox" class="custom-control-input"
                                           id="comicTag5" value="搞笑" name="comicTag" v-model="comicTag"
                                           :disabled="isDetailModal"/>
                                    <label class="custom-control-label" for="comicTag5">搞笑</label>
                                </div>
                                <div class="custom-control custom-checkbox custom-control-inline">
                                    <input type="checkbox" class="custom-control-input"
                                           id="comicTag6" value="科幻" name="comicTag" v-model="comicTag"
                                           :disabled="isDetailModal"/>
                                    <label class="custom-control-label" for="comicTag6">科幻</label>
                                </div>
                                <div class="custom-control custom-checkbox custom-control-inline">
                                    <input type="checkbox" class="custom-control-input"
                                           id="comicTag7" value="治愈" name="comicTag" v-model="comicTag"
                                           :disabled="isDetailModal"/>
                                    <label class="custom-control-label" for="comicTag7">治愈</label>
                                </div>
                                <div class="custom-control custom-checkbox custom-control-inline">
                                    <input type="checkbox" class="custom-control-input"
                                           id="comicTag8" value="恐怖" name="comicTag" v-model="comicTag"
                                           :disabled="isDetailModal"/>
                                    <label class="custom-control-label" for="comicTag8">恐怖</label>
                                </div>
                                <div class="custom-control custom-checkbox custom-control-inline">
                                    <input type="checkbox" class="custom-control-input"
                                           id="comicTag9" value="推理" name="comicTag" v-model="comicTag"
                                           :disabled="isDetailModal"/>
                                    <label class="custom-control-label" for="comicTag9">推理</label>
                                </div>
                                <div class="custom-control custom-checkbox custom-control-inline">
                                    <input type="checkbox" class="custom-control-input"
                                           id="comicTag10" value="战斗" name="comicTag" v-model="comicTag"
                                           :disabled="isDetailModal"/>
                                    <label class="custom-control-label" for="comicTag10">战斗</label>
                                </div>
                                <div class="custom-control custom-checkbox custom-control-inline">
                                    <input type="checkbox" class="custom-control-input"
                                           id="comicTag11" value="萝莉" name="comicTag" v-model="comicTag"
                                           :disabled="isDetailModal"/>
                                    <label class="custom-control-label" for="comicTag11">萝莉</label>
                                </div>
                                <div class="custom-control custom-checkbox custom-control-inline">
                                    <input type="checkbox" class="custom-control-input"
                                           id="comicTag12" value="校园" name="comicTag" v-model="comicTag"
                                           :disabled="isDetailModal"/>
                                    <label class="custom-control-label" for="comicTag12">校园</label>
                                </div>
                                <div class="custom-control custom-checkbox custom-control-inline">
                                    <input type="checkbox" class="custom-control-input"
                                           id="comicTag13" value="奇幻" name="comicTag" v-model="comicTag"
                                           :disabled="isDetailModal"/>
                                    <label class="custom-control-label" for="comicTag13">奇幻</label>
                                </div>
                                <div class="custom-control custom-checkbox custom-control-inline">
                                    <input type="checkbox" class="custom-control-input"
                                           id="comicTag14" value="百合" name="comicTag" v-model="comicTag"
                                           :disabled="isDetailModal"/>
                                    <label class="custom-control-label" for="comicTag14">百合</label>
                                </div>
                                <div class="custom-control custom-checkbox custom-control-inline">
                                    <input type="checkbox" class="custom-control-input"
                                           id="comicTag15" value="日常" name="comicTag" v-model="comicTag"
                                           :disabled="isDetailModal"/>
                                    <label class="custom-control-label" for="comicTag15">日常</label>
                                </div>
                                <div class="custom-control custom-checkbox custom-control-inline">
                                    <input type="checkbox" class="custom-control-input"
                                           id="comicTag16" value="致郁" name="comicTag" v-model="comicTag"
                                           :disabled="isDetailModal"/>
                                    <label class="custom-control-label" for="comicTag16">致郁</label>
                                </div>
                                <div class="custom-control custom-checkbox custom-control-inline">
                                    <input type="checkbox" class="custom-control-input"
                                           id="comicTag17" value="剧场版" name="comicTag" v-model="comicTag"
                                           :disabled="isDetailModal"/>
                                    <label class="custom-control-label" for="comicTag17">剧场版</label>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-form-label"> 自定义标签：</label>
                                <div class='row'>
                                    <input type="text" class="form-control col-2 ml-3"
                                           name="freelabel" placeholder="标签一" v-model="freeLabelA"
                                           :disabled="isDetailModal"/>
                                    <input type="text" class="form-control col-2 offset-1"
                                           name="freelabel" placeholder="标签二" v-model="freeLabelB"
                                           :disabled="isDetailModal"/>
                                    <input type="text" class="form-control col-2 offset-1"
                                           name="freelabel" placeholder="标签三" v-model="freeLabelC"
                                           :disabled="isDetailModal"/>
                                    <input type="text"
                                           class="form-control col-2 offset-1"
                                           name="freelabel" placeholder="标签四" v-model="freeLabelD"
                                           :disabled="isDetailModal"/>
                                </div>
                            </div>
                            <div class="form-group d-none">
                                <label class="col-form-label"> 标签汇总：</label>
                                <input type="text" class="form-control"
                                       name="comicLabel" v-model="comicLabel"/>
                            </div>
                            <div class="form-group">
                                <label class="col-form-label"> 上传图片：</label>
                                <div class="custom-file" v-show="!isDetailModal">
                                    <input type="file" class="custom-file-input"
                                           name="cmImgFile" @change="cmImgFileChange"/>
                                    <label class="custom-file-label">{{cmImgFileLb}}</label>
                                </div>
                                <br/> <br/>
                                <img :src="cmImgFilePv" class="rounded" width="30%"/>
                            </div>
                            <div class="form-group">
                                <label class="col-form-label"> 观看地址：</label>
                                <input type="url" class="form-control" name="comicLink"
                                       placeholder="请输入观看地址" v-model="comicLink" :disabled="isDetailModal"/>
                            </div>
                            <div class="form-group">
                                <label class="col-form-label"> 上架状态：</label>
                                <div class="custom-control custom-radio custom-control-inline">
                                    <input type="radio" id="comicShelfStatus1" name="comicShelfStatus"
                                           class="custom-control-input" value="1" v-model="comicShelfStatus"
                                           :disabled="isDetailModal"/>
                                    <label class="custom-control-label" for="comicShelfStatus1">上架</label>
                                </div>
                                <div class="custom-control custom-radio custom-control-inline">
                                    <input type="radio" id="comicShelfStatus2" name="comicShelfStatus"
                                           class="custom-control-input" value="0" v-model="comicShelfStatus"
                                           :disabled="isDetailModal"/>
                                    <label class="custom-control-label" for="comicShelfStatus2">下架</label>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-danger" data-dismiss="modal">
                                <i class="fa fa-close fa-lg"></i>&nbsp;&nbsp;关闭
                            </button>
                            <button type="button" class="btn btn-primary"
                                    @click="insertContent" v-show="isInsertModal">
                                <i class="fa fa-check fa-lg"></i>&nbsp;&nbsp;提交
                            </button>
                            <button type="button" class="btn btn-primary"
                                    @click="updateContent" v-show="!isInsertModal && !isDetailModal">
                                <i class="fa fa-check fa-lg"></i>&nbsp;&nbsp;提交
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

    </div>

    <script>
        var comicInfoThat = this;

        const containerVm = new Vue({
            el: "#container",
            data: {
                ids: [],
                nowPageNum: 1,
                pageInfo: "",
                modalTitle: "",
                isInsertModal: false,
                isDetailModal: false,
                isUdTimeShow: false,
                id: 0,
                comicName: "",
                comicTime: "",
                comicContent: "",
                comicStatus: 0,
                comicUdTime: "",
                comicCurrentEpisodes: 1,
                comicTag: [],
                freeLabelA: "",
                freeLabelB: "",
                freeLabelC: "",
                freeLabelD: "",
                cmImgFileLb: "示例图片.jpg",
                cmImgFilePv: "/images/tpjxz.jpg",
                comicLink: "",
                comicShelfStatus: 1,
                cmImgFileLbTmp: "",
                cmImgFilePvTmp: ""
            },
            methods: {
                getPage: function () {
                    $("#selectContentForm").ajaxSubmit({
                        url: "/comic/getPageToB",
                        data: {
                            pageNum: this.nowPageNum
                        },
                        type: "post",
                        dataType: "json",
                        success: function (res) {
                            if (res.code == 200) {
                                containerVm.pageInfo = res.data;
                            } else {
                                containerVm.pageInfo = "";
                            }
                        }
                    });
                },
                toFirstPage: function () {
                    this.nowPageNum = 1;
                    this.getPage();
                    this.scrollUp();
                },
                toPrePage: function () {
                    this.nowPageNum = this.nowPageNum - 1;
                    this.getPage();
                    this.scrollUp();
                },
                toNextPage: function () {
                    this.nowPageNum = this.nowPageNum + 1;
                    this.getPage();
                    this.scrollUp();
                },
                toLastPage: function (lastPage) {
                    this.nowPageNum = lastPage;
                    this.getPage();
                    this.scrollUp();
                },
                toClickPage: function (clickPage) {
                    this.nowPageNum = clickPage;
                    this.getPage();
                    this.scrollUp();
                },
                selectContent: function () {
                    this.nowPageNum = 1;
                    $("#selectContentForm").ajaxSubmit({
                        url: "/comic/getPageToB",
                        data: {
                            pageNum: this.nowPageNum
                        },
                        type: "post",
                        dataType: "json",
                        success: function (res) {
                            if (res.code == 200) {
                                containerVm.pageInfo = res.data;
                            } else {
                                containerVm.pageInfo = "";
                            }
                        }
                    });
                },
                clearSelectContent: function() {
                    $("#selectContentForm").resetForm();
                    this.selectContent();
                },
                insertModalOpen: function () {
                    this.modalTitle = "『添加窗口』";
                    this.isDetailModal = false;
                    this.isInsertModal = true;
                    $("#comicModal").modal();
                },
                insertContent: function () {
                    if (this.comicName.trim() == "") {
                        toastr.error("番剧名不能为空");
                    } else if (this.comicContent.length >= 500) {
                        toastr.error("内容不能超过500个字符");
                    } else {
                        $("#comicForm").ajaxSubmit({
                            url: "/comic/insert",
                            type: "post",
                            dataType: "json",
                            success: function (res) {
                                $("#comicModal").modal('hide');
                                if (res.code == 200) {
                                    toastr.success(res.msg);
                                    containerVm.clearSelectContent();
                                } else if (res.code == 101) {
                                    console.log(res.msg);
                                } else {
                                    toastr.error(res.msg);
                                }
                            }
                        });
                    }
                },
                deleteBatch: function () {
                    bootbox.confirm({
                        size: "small",
                        title: "<i class='fa fa-comment'></i>&nbsp;&nbsp;提示",
                        message: "确定要删除选中项吗？",
                        buttons: {
                            confirm: {
                                label: '确定',
                                className: 'btn-success'
                            },
                            cancel: {
                                label: '取消',
                                className: 'btn-danger'
                            }
                        },
                        backdrop: true,
                        closeButton: false,
                        callback: function (result) {
                            if (result == true) {
                                if (containerVm.ids.length == 0) {
                                    toastr.error("请至少选择一项删除");
                                } else {
                                    $.ajax({
                                        url: "/comic/deleteBatchByIds",
                                        data: {
                                            ids: containerVm.ids.toString()
                                        },
                                        type: "post",
                                        dataType: "json",
                                        success: function (res) {
                                            if (res.code == 200) {
                                                toastr.success(res.msg);
                                                containerVm.toClickPage(containerVm.nowPageNum);
                                            }
                                        }
                                    });
                                }
                            }
                        }
                    });
                },
                detlAndUpdtModalSetVal: function (id) {
                    $.ajax({
                        url: "/comic/getOneById",
                        data: {
                            id: id
                        },
                        type: "post",
                        dataType: 'json',
                        success: function (res) {
                            if (res.code == 200) {
                                containerVm.id = res.data.id;
                                containerVm.comicName = res.data.comicName;
                                containerVm.comicTime = res.data.comicTime;
                                $(".datepicker").datepicker("setDate", res.data.comicTime);
                                containerVm.comicContent = res.data.comicContent;
                                if (res.data.comicStatus == 0) {
                                    containerVm.comicStatus = 0;
                                } else {
                                    containerVm.comicStatus = 8;
                                    containerVm.comicUdTime = res.data.comicStatus;
                                }
                                containerVm.comicCurrentEpisodes = res.data.comicCurrentEpisodes;
                                containerVm.comicLabel = res.data.comicLabel;
                                let fileName = res.data.comicImageUrl;
                                let fileNewNameStart = fileName.lastIndexOf("/");
                                containerVm.cmImgFileLb = fileName.substring(fileNewNameStart + 1);
                                containerVm.cmImgFilePv = "/" + res.data.comicImageUrl;
                                containerVm.comicLink = res.data.comicLink;
                                containerVm.comicShelfStatus = res.data.comicShelfStatus;
                                containerVm.cmImgFileLbTmp = fileName.substring(fileNewNameStart + 1);
                                containerVm.cmImgFilePvTmp = "/" + res.data.comicImageUrl;
                                $('#comicModal').modal();
                            }
                        }
                    });
                },
                detailModalOpen: function (id) {
                    this.isDetailModal = true;
                    this.modalTitle = "『详情窗口』";
                    this.isInsertModal = false;
                    this.detlAndUpdtModalSetVal(id);
                },
                updateModalOpen: function (id) {
                    this.isDetailModal = false;
                    this.modalTitle = "『修改窗口』";
                    this.isInsertModal = false;
                    this.detlAndUpdtModalSetVal(id);
                },
                updateContent: function () {
                    if (this.comicName.trim() == "") {
                        toastr.error("番剧名不能为空");
                    } else if (this.comicContent.length >= 500) {
                        toastr.error("内容不能超过500个字符");
                    } else {
                        $("#comicForm").ajaxSubmit({
                            url: "/comic/update",
                            type: "post",
                            dataType: "json",
                            success: function (res) {
                                $('#comicModal').modal('hide');
                                if (res.code == 200) {
                                    toastr.success(res.msg);
                                    containerVm.getPage();
                                } else if (res.code == 101) {
                                    console.log(res.msg);
                                } else {
                                    toastr.error(res.msg);
                                }
                            }
                        });
                    }
                },
                datePickerBind: function () {
                    $(".datepicker").datepicker().on("hide", function () {
                        containerVm.comicTime = $(this).val();
                    });
                },
                cmImgFileChange: function (e) {
                    if (e.target.files.length != 0) {
                        let file = e.target.files[0];
                        let fileName = file.name;
                        if (!/.(gif|jpg|jpeg|png|GIF|JPG|PNG)$/.test(fileName)) {
                            toastr.error("图片格式必须是.gif,jpeg,jpg,png中的一种");
                            if (this.isInsertModal) {
                                this.cmImgFileLb = "示例图片.jpg";
                                this.cmImgFilePv = "/images/tpjxz.jpg";
                            } else {
                                this.cmImgFileLb = this.cmImgFileLbTmp;
                                this.cmImgFilePv = this.cmImgFilePvTmp;
                            }
                            $("input[name='cmImgFile']").val("");
                        } else if ((file.size).toFixed(2) >= 102400) {
                            toastr.error("图片不能超过100KB");
                            if (this.isInsertModal) {
                                this.cmImgFileLb = "示例图片.jpg";
                                this.cmImgFilePv = "/images/tpjxz.jpg";
                            } else {
                                this.cmImgFileLb = this.cmImgFileLbTmp;
                                this.cmImgFilePv = this.cmImgFilePvTmp;
                            }
                            $("input[name='cmImgFile']").val("");
                        } else {
                            this.cmImgFileLb = fileName;
                            let reader = new FileReader();
                            reader.readAsDataURL(file);
                            reader.onload = function (e) {
                                containerVm.cmImgFilePv = e.target.result;
                            }
                        }
                    } else {
                        if (this.isInsertModal) {
                            this.cmImgFileLb = "示例图片.jpg";
                            this.cmImgFilePv = "/images/tpjxz.jpg";
                        } else {
                            this.cmImgFileLb = this.cmImgFileLbTmp;
                            this.cmImgFilePv = this.cmImgFilePvTmp;
                        }
                    }
                },
                modalReset: function () {
                    $('#comicModal').on('hidden.bs.modal', function () {
                        containerVm.id = 0;
                        containerVm.comicName = "";
                        containerVm.comicTime = "";
                        containerVm.comicContent = "";
                        containerVm.comicStatus = 0;
                        containerVm.comicUdTime = "";
                        containerVm.comicCurrentEpisodes = 1;
                        containerVm.comicTag = [];
                        containerVm.freeLabelA = "";
                        containerVm.freeLabelB = "";
                        containerVm.freeLabelC = "";
                        containerVm.freeLabelD = "";
                        containerVm.cmImgFileLb = "示例图片.jpg";
                        containerVm.cmImgFilePv = "/images/tpjxz.jpg";
                        containerVm.comicLink = "";
                        containerVm.comicShelfStatus = 1;
                        $(".datepicker").datepicker('clearDates');
                        $("input[name='cmImgFile']").val("");
                    });
                },
                scrollUp: function () {
                    $("#scrollUp").click();
                }
            },
            watch: {
                comicStatus: function () {
                    this.isUdTimeShow = this.comicStatus == 8;
                    if (this.comicStatus == 0) {
                        this.comicUdTime = "";
                    }
                }
            },
            computed: {
                freeLabelArr: {
                    get: function () {
                        let tempFreeLabel = [];
                        tempFreeLabel.push(this.freeLabelA);
                        tempFreeLabel.push(this.freeLabelB);
                        tempFreeLabel.push(this.freeLabelC);
                        tempFreeLabel.push(this.freeLabelD);
                        return tempFreeLabel;
                    },
                    set: function (value) {
                        this.freeLabelA = value[0];
                        this.freeLabelB = value[1];
                        this.freeLabelC = value[2];
                        this.freeLabelD = value[3];
                    }
                },
                comicLabel: {
                    get: function () {
                        return this.comicTag.concat(this.freeLabelArr);
                    },
                    set: function (value) {
                        let labelArr = value.split(",");
                        this.comicTag = labelArr.slice(0, labelArr.length - 4);
                        let tempFreeLabel = [];
                        tempFreeLabel.push(labelArr[labelArr.length - 4]);
                        tempFreeLabel.push(labelArr[labelArr.length - 3]);
                        tempFreeLabel.push(labelArr[labelArr.length - 2]);
                        tempFreeLabel.push(labelArr[labelArr.length - 1]);
                        this.freeLabelArr = tempFreeLabel;
                    }
                }
            },
            mounted: function () {
                comicInfoThat.initToastr();
                comicInfoThat.initDatePicker();
                comicInfoThat.initScrollUp();
                comicInfoThat.initImgLazyLoad();
                this.datePickerBind();
                this.modalReset();
                this.getPage();
            }
        });

        Vue.filter("cmStatusFilter", function (status, currentEpisodes) {
            let arrCmStatus = ['已完结', '周一更新', '周二更新', '周三更新', '周四更新', '周五更新', '周六更新', '周日更新'
                , '更新中'];
            for (let i = 0; i < arrCmStatus.length; i++) {
                if (status == 0) {
                    return arrCmStatus[i] + "：全" + currentEpisodes + "话";
                } else if (status == i) {
                    return arrCmStatus[i] + "：更新至第" + currentEpisodes + "话";
                }
            }
        });

        Vue.filter("cmLabelFilter", function (value) {
            let arrCmLabel = (value).split(",");
            let arrNewCmLabel = [];
            for (let i = 0; i < arrCmLabel.length; i++) {
                if (arrCmLabel[i] != "") {
                    arrNewCmLabel.push(arrCmLabel[i]);
                }
            }
            return arrNewCmLabel.toString();
        });

        Vue.filter("cmContentFilter", function (value) {
            let subContent = value.substr(0, 200).trim();
            return subContent + "...";
        });
    </script>

    <style>
        /* 番剧图片 */
        .r2 .c1 .table-cmimg {
            width: 165px;
            height: 217px;
        }

        /* 番剧内容p */
        .r2 .c1 .table-cmcontent {
            line-height: 16px;
            height: 224px;
            overflow: hidden;
        }

        /* 番剧图片遮罩 */
        .box {
            width: 165px;
            height: 217px;
            position: relative;
            cursor: pointer;
        }

        .box .bmbox {
            width: 165px;
            height: 217px;
            background: black;
            position: absolute;
            bottom: 35px;
            left: 12px;
            display: none;
            font-size: 18px;
            color: white;
            text-align: center;
            padding-top: 70px;
            border-radius: .25rem;
        }

        .box:hover .bmbox {
            width: 165px;
            height: 217px;
            background: rgba(0, 0, 0, 0.5);
            position: absolute;
            bottom: 35px;
            left: 12px;
            display: block;
            font-size: 12px;
            color: white;
            text-align: center;
            padding-top: 70px;
            border-radius: .25rem;
        }
    </style>

</div>